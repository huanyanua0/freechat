<!DOCTYPE html>
<html>
<head>
    <title>æç®€åŒ¿åèŠ</title>
    <script src="https://cdn.jsdelivr.net/combine/npm/peerjs@1.4.7/dist/peerjs.min.js,gh/mdn/dom-examples@main/web-crypto/encrypt-decrypt/script.js"></script>
</head>
<body style="margin:20px">
    <h2>ğŸ“± è¾“å…¥æ¶ˆæ¯å¼€å§‹èŠå¤©</h2>
    <input id="msg" placeholder="è¾“å…¥æ–‡å­—..." style="width:200px;padding:8px">
    <button onclick="send()" style="padding:8px">å‘é€</button>
    <div id="chat" style="margin-top:20px"></div>
    
    <script>
        let peer, conn
        // è‡ªåŠ¨ç”Ÿæˆè®¾å¤‡ç 
        const deviceCode = Math.random().toString(36).slice(2,10)
        const link = `${location.href}?peer=${deviceCode}`
        
        // åˆå§‹åŒ–
        peer = new Peer(deviceCode)
        peer.on('connection', c => {
            conn = c
            conn.on('data', data => {
                document.getElementById('chat').innerHTML += `<div>å¯¹æ–¹ï¼š${data}</div>`
            })
        })

        // å‘é€æ¶ˆæ¯
        function send() {
            const msg = document.getElementById('msg').value
            if(conn) {
                conn.send(msg)
                document.getElementById('chat').innerHTML += `<div>æˆ‘ï¼š${msg}</div>`
            } else alert('è¯·å…ˆåˆ†äº«ä¸‹æ–¹é“¾æ¥ç»™èŠå¤©å¯¹è±¡ï¼')
        }

        // æ˜¾ç¤ºåˆ†äº«é“¾æ¥
        document.write(`
            <div style="margin-top:30px;border:1px solid #ccc;padding:15px">
                <b>ä½ çš„ä¸“å±é“¾æ¥ï¼š</b><br>
                <input value="${link}" id="myLink" style="width:300px;margin:10px 0"><br>
                <button onclick="navigator.clipboard.writeText('${link}')">å¤åˆ¶é“¾æ¥</button>
                <button onclick="window.open('https://cli.im/?text=${encodeURIComponent(link)}')">ç”ŸæˆäºŒç»´ç </button>
            </div>
        `)
    </script>
</body>
</html>